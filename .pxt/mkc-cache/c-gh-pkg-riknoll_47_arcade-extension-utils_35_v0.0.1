{"files":{"pxt.json":"{\n    \"name\": \"arcade-extension-utils\",\n    \"version\": \"0.0.1\",\n    \"files\": [\n        \"main.ts\"\n    ],\n    \"supportedTargets\": [\n        \"arcade\"\n    ],\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"testDependencies\": {}\n}","main.ts":"namespace __util {\n    export class StateFactory<U> {\n        protected stateStack: U[];\n\n        constructor(public create: () => U) {\n            this.stateStack = [this.create()];\n\n            game.addScenePushHandler(() => {\n                this.stateStack.push(this.create());\n            });\n\n            game.addScenePopHandler(() => {\n                this.stateStack.pop();\n                if (this.stateStack.length === 0) {\n                    this.stateStack.push(this.create());\n                }\n            });\n        }\n\n        state(): U {\n            return this.stateStack[this.stateStack.length - 1];\n        }\n    }\n\n    let registry: StateFactory<any>[];\n\n    export function getState<U>(factory: () => U): U {\n        if (!registry) registry = [];\n\n        for (const f of registry) {\n            if (f.create === factory) return f.state();\n        }\n\n        const newFactory = new StateFactory(factory);\n        registry.push(newFactory)\n\n        return newFactory.state();\n    }\n}"}}